import telebot
import json
import os
from telebot.types import ReplyKeyboardMarkup, KeyboardButton

TOKEN = os.getenv('TOKEN')  # –¢–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Render
bot = telebot.TeleBot(TOKEN)

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π
days_map = {
  {
  "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫": [
    {"–≤—Ä–µ–º—è": "8.00 - 8.40 , "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –†–∞–∑–≥–æ–≤–æ—Ä—ã –æ –≤–∞–∂–Ω–æ–º"},
    {"–≤—Ä–µ–º—è": "9.00 ‚Äì 9.40 ", "—É—Ä–æ–∫": "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ "},
    {"–≤—Ä–µ–º—è": "10.00 ‚Äì 10.40 ", "—É—Ä–æ–∫": "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ "}
 {"–≤—Ä–µ–º—è": "10.50 ‚Äì 11.30  ", "—É—Ä–æ–∫": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞  "}
 {"–≤—Ä–µ–º—è": "11.50 ‚Äì 12.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å"}
  ],
  "–≤—Ç–æ—Ä–Ω–∏–∫": [
    {"–≤—Ä–µ–º—è": "8.00 - 8.40 , "—É—Ä–æ–∫": "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ  "},
    {"–≤—Ä–µ–º—è": "9.00 ‚Äì 9.40 ", "—É—Ä–æ–∫": "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫  "},
    {"–≤—Ä–µ–º—è": "10.00 ‚Äì 10.40 ", "—É—Ä–æ–∫": "–®–∞—Ö–º–∞—Ç—ã"}
 {"–≤—Ä–µ–º—è": "10.50 ‚Äì 11.30  ", "—É—Ä–æ–∫": "–û–∫—Ä—É–∂–∞—é—â–∏–π –º–∏—Ä   "}
 {"–≤—Ä–µ–º—è": "11.50 ‚Äì 12.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"}
  ],
  "—Å—Ä–µ–¥–∞": [
  {"–≤—Ä–µ–º—è": "8.00 - 8.40 , "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ "},
    {"–≤—Ä–µ–º—è": "9.00 ‚Äì 9.40 ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ú—É–∑—ã–∫–∞"},
    {"–≤—Ä–µ–º—è": "10.00 ‚Äì 10.40 ", "—É—Ä–æ–∫": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"}
 {"–≤—Ä–µ–º—è": "10.50 ‚Äì 11.30  ", "—É—Ä–æ–∫": "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫"}
 {"–≤—Ä–µ–º—è": "11.50 ‚Äì 12.30  ", "—É—Ä–æ–∫": "–¢—Ä—É–¥ "}
],
  "—á–µ—Ç–≤–µ—Ä–≥": [
  {"–≤—Ä–µ–º—è": "8.00 - 8.40 , "—É—Ä–æ–∫": "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ"},
    {"–≤—Ä–µ–º—è": "9.00 ‚Äì 9.40 ", "—É—Ä–æ–∫": "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ "},
    {"–≤—Ä–µ–º—è": "10.00 ‚Äì 10.40 ", "—É—Ä–æ–∫": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"}
 {"–≤—Ä–µ–º—è": "10.50 ‚Äì 11.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ò–∑–æ–±—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ"}
 {"–≤—Ä–µ–º—è": "11.50 ‚Äì 12.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ú–æ—è –ú–æ—Å–∫–≤–∞- –≥–æ—Ä–∂—É—Å—å —Ç–æ–±–æ–π!"}
  ],
  {"–≤—Ä–µ–º—è": "8.00 - 8.40 , "—É—Ä–æ–∫": "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ"},
    {"–≤—Ä–µ–º—è": "9.00 ‚Äì 9.40 ", "—É—Ä–æ–∫": "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫ "},
    {"–≤—Ä–µ–º—è": "10.00 ‚Äì 10.40 ", "—É—Ä–æ–∫": "–û–∫—Ä—É–∂–∞—é—â–∏–π –º–∏—Ä"}
 {"–≤—Ä–µ–º—è": "10.50 ‚Äì 11.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –§–∏–∑–∏—á–µ—Å–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ "}
 {"–≤—Ä–µ–º—è": "11.50 ‚Äì 12.30  ", "—É—Ä–æ–∫": "–í–Ω–µ—É—Ä–æ—á–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ó–∞–Ω–∏–º–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"}
  ],
  "—Å—É–±–±–æ—Ç–∞": [
 {"–≤—Ä–µ–º—è": "–≤–µ—Å—å –¥–µ–Ω—å –≤—ã—Ö–æ–¥–Ω–æ–π"},
],
  "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ": [
 {"–≤—Ä–µ–º—è": "–≤–µ—Å—å –¥–µ–Ω—å –≤—ã—Ö–æ–¥–Ω–æ–π"},

}

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
with open('schedule.json', 'r', encoding='utf-8') as f:
    schedule = json.load(f)

# –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –¥–Ω—è–º–∏
def get_days_keyboard():
    markup = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=False)
    markup.add(KeyboardButton('üìÖ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫'), KeyboardButton('üìÖ –í—Ç–æ—Ä–Ω–∏–∫'))
    markup.add(KeyboardButton('üìÖ –°—Ä–µ–¥–∞'), KeyboardButton('üìÖ –ß–µ—Ç–≤–µ—Ä–≥'))
    markup.add(KeyboardButton('üìÖ –ü—è—Ç–Ω–∏—Ü–∞'), KeyboardButton('üìÖ –°—É–±–±–æ—Ç–∞'))
    markup.add(KeyboardButton('üìÖ –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'))
    return markup

@bot.message_handler(commands=['start'])
def start(message):
    bot.reply_to(message, 
        "üîî –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —É—Ä–æ–∫–æ–≤.\n"
        "–ù–∞–ø–∏—à–∏ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ:",
        reply_markup=get_days_keyboard())

@bot.message_handler(content_types=['text'])
def handle_day(message):
    day_input = message.text.lower().strip().replace('üìÖ ', '')
    day = days_map.get(day_input)
    
    if not day:
        bot.reply_to(message, 
            "‚ùå –ù–µ –ø–æ–Ω—è–ª –¥–µ–Ω—å. –í—ã–±–µ—Ä–∏ –∏–∑ –∫–Ω–æ–ø–æ–∫ –∏–ª–∏ –Ω–∞–ø–∏—à–∏: –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, –≤—Ç–æ—Ä–Ω–∏–∫...", 
            reply_markup=get_days_keyboard())
        return
    
    if day not in schedule or not schedule[day]:
        bot.reply_to(message, f"üìÖ –ù–∞ {day.capitalize()} —É—Ä–æ–∫–æ–≤ –Ω–µ—Ç!", reply_markup=get_days_keyboard())
        return
    
    text = f"üìö –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ <b>{day.capitalize()}</b>:\n\n"
    for lesson in schedule[day]:
        text += f"‚è∞ <b>{lesson['–≤—Ä–µ–º—è']}</b> - {lesson['—É—Ä–æ–∫']}\n"
    
    bot.reply_to(message, text, parse_mode='HTML', reply_markup=get_days_keyboard())

print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
bot.infinity_polling()
